<mat-card>
  <mat-card-title>
    <span>Product List</span>
    <button mat-mini-fab class="action-btn" color="warn" matTooltip="Add" matTooltipPosition="above" [routerLink]="['./',0]"
      *ngIf="pageContentIsEditable">
      <mat-icon>add</mat-icon>
    </button>
  </mat-card-title>
  <mat-divider></mat-divider>
  <!--{{ (dataSource$ | async)?.list | json}}-->
  <mat-card-content>
    <mat-card>
      <mat-card-content fxLayout="column">
        <div>
          <mat-form-field fxFlex="100%">
            <input matInput #filter="ngModel"  placeholder="Filter" [(ngModel)]="filterV" >
          </mat-form-field>
        </div>
        <div>
          <mat-form-field>
            <mat-select [(ngModel)]="selectC" name="ProductCategory" placeholder="Product Category" #selectedCategory="ngModel"  >
              <mat-option *ngFor="let category of categories" [value]="category.value">
                {{category.optionText}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-slide-toggle #reviewsSubmittedByCurrentUser="ngModel" ngModel>
            {{reviewsSubmittedByCurrentUser.value ? 'Only show product that last updated user who is me.' : 'Show all product.'}}
          </mat-slide-toggle>
        </div>
        <div>
          <mat-table #table [dataSource]="(dataSource$ | async)?.list" matSort class="table table-hover table-striped table-bordered table-condensed">
            <ng-container cdkColumnDef="name">
              <mat-header-cell *cdkHeaderCellDef mat-sort-header>Product Name</mat-header-cell>
              <mat-cell *cdkCellDef="let row"> {{row.name}} </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="series">
              <mat-header-cell *cdkHeaderCellDef mat-sort-header>Series</mat-header-cell>
              <mat-cell *cdkCellDef="let row"> {{row.series}} </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="type">
              <mat-header-cell *cdkHeaderCellDef>Page Type</mat-header-cell>
              <mat-cell *cdkCellDef="let row"> {{productPageTypeMap.get(row.type)}} </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="rootCategories">
              <mat-header-cell *cdkHeaderCellDef>Category</mat-header-cell>
              <mat-cell *cdkCellDef="let row"> {{row.rootCategories}} </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="langOnTheMarket">
              <mat-header-cell *cdkHeaderCellDef>Available Lang</mat-header-cell>
              <mat-cell *cdkCellDef="let row"> {{row.langOnTheMarket}} </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="reviewState">
              <mat-header-cell *cdkHeaderCellDef>Review State</mat-header-cell>
              <mat-cell *cdkCellDef="let row"> {{productReviewStateTypeMap.get(row.reviewState)}} </mat-cell>
            </ng-container>

            <!--<ng-container cdkColumnDef="msg">
                <mat-header-cell *cdkHeaderCellDef>msg</mat-header-cell>
                <mat-cell *cdkCellDef="let row"> {{row.msg}} </mat-cell>
              </ng-container>-->

            <ng-container cdkColumnDef="action">
              <mat-header-cell *cdkHeaderCellDef fxLayout="row" fxFlex="400px" fxLayoutAlign="center center"> Action
              </mat-header-cell>
              <mat-cell *cdkCellDef="let row" fxLayout="row wrap" fxFlex="400px" fxLayoutAlign="center center">
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Edit Detail" matTooltipPosition="above"
                  [routerLink]="['./',row.id]" [queryParams]="{filter: filterV, select : selectC}" *ngIf="pageContentIsViewable && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Edit Available Lang" (click)="editAvailableLang(row)"
                  matTooltipPosition="above" *ngIf="pageIsEditable && row.reviewState===productReviewStateType.Passed">
                  <mat-icon>language</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Edit Tabs" matTooltipPosition="above"
                  [routerLink]="['./tab',row.id]" [queryParams]="{filter: filterV, select : selectC}" *ngIf="pageContentIsViewable && row.type !== 4 && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>tab</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Edit Product Specification"
                  matTooltipPosition="above" [routerLink]="[row.id, 'specification']" [queryParams]="{filter: filterV, select : selectC}" *ngIf="pageContentIsViewable && row.type !== 4 && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>settings</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Edit Product Selector"
                  matTooltipPosition="above" [routerLink]="[row.id, 'selector']" [queryParams]="{filter: filterV, select : selectC}" *ngIf="pageContentIsViewable && row.type !== 4 && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>filter_list</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Edit PDF Content"
                  matTooltipPosition="above" [routerLink]="[row.id, 'pdf-info']" [queryParams]="{filter: filterV, select : selectC}" *ngIf="pageContentIsViewable && row.type !== 4 && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>picture_as_pdf</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Export PDF" matTooltipPosition="above"
                  (click)="exportPDF(row.id, row.name)" *ngIf="row.type !== 4 && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>cloud_download</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="primary" matTooltip="Submit for review"
                  matTooltipPosition="above" (click)="submitReview(row)" *ngIf="pageIsEditable && (row.reviewState===productReviewStateType.Draft || row.reviewState===productReviewStateType.Rejected)">
                  <mat-icon>send</mat-icon>
                </button>
                <button mat-mini-fab class="action-btn" color="warn" matTooltip="Delete" matTooltipPosition="above"
                  (click)="delete(row.id, row.name)" [disabled]="isLoading" *ngIf="pageIsEditable && row.reviewState!==productReviewStateType.Pending">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-cell>
            </ng-container>

            <mat-header-row *cdkHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *cdkRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
          <mat-paginator #paginator [length]="(dataSource$ | async)?.filterTotal" [pageIndex]="0" [pageSize]="10"
            [pageSizeOptions]="[10, 30, 50, 100]">
          </mat-paginator>
        </div>
        <vvtk-loader *ngIf="isLoading"></vvtk-loader>
      </mat-card-content>
    </mat-card>
  </mat-card-content>
</mat-card>
