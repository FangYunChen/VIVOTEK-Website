<div fxLayout="row">
  <mat-card fxFlex="100%">
    <mat-card-title fxLayout>
      <span>{{(id==0)?'Add':'Edit'}} Successful Cases</span>
      <span fxFlex></span>
      <vvtk-language-selector *ngIf="id>0"></vvtk-language-selector>
    </mat-card-title>
    <mat-divider></mat-divider>
    <mat-card-content fxLayout="column">
      <form #form="ngForm">
        <mat-card fxFlex="100%">
          <!--基本資訊-->
          <mat-card-content fxLayout="column">
            <mat-form-field fxFlex>
              <input matInput maxlength="255" placeholder="Title" name="title" [(ngModel)]="data.title" [readOnly]="!pageIsEditable" required>
            </mat-form-field>
            <mat-form-field fxFlex>
              <mat-datepicker-toggle matPrefix [for]="picker" *ngIf="pageIsEditable"></mat-datepicker-toggle>
              <input matInput [matDatepicker]="picker" placeholder="Date (Applied to All)" name="publishAt" [(ngModel)]="publishAt" [readOnly]="!pageIsEditable"
                required readonly>
            </mat-form-field>
            <mat-datepicker #picker></mat-datepicker>
            <mat-form-field fxFlex>
              <input matInput maxlength="255" placeholder="Vertical" name="vertical" [(ngModel)]="data.vertical" [readOnly]="!pageIsEditable"
                required>
            </mat-form-field>
            <mat-form-field fxFlex *ngIf="!pageIsEditable">
              <input matInput placeholder="Country (Applied to All)" name="country" [value]="getCountryName(data.country.id)" readOnly>
            </mat-form-field>
            <vvtk-input-container fxLayout="column" *ngIf="pageIsEditable">
              <div fxLayout="column" vvtkhtml>
                <mat-form-field>
                  <mat-select name="country" placeholder="Country (Applied to All)" [(ngModel)]="data.country.id" required>
                    <mat-option *ngFor="let country of countries" [value]="country.id">{{country.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <input type="text" class="hidden-input" [value]="data.country" required />
              </div>
            </vvtk-input-container>
          </mat-card-content>
          <!--Solutions-->
          <mat-card-content fxLayout="column">
            <button type="button" mat-button (click)="addSolution(0)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Solution</button>
            <div [sortablejs]="data.solutions" [sortablejsOptions]="groupOptions">
              <div fxLayout="column" fxLayoutAlign="start stretch" *ngFor="let solution of data.solutions; let i = index">
                <mat-card-title>
                  <mat-icon class="drag-handle" *ngIf="pageIsEditable">drag_handle</mat-icon>
                  <h3>Solution {{i+1}}</h3>
                  <a mat-mini-fab class="action-btn" color="accent" matTooltip="Delete Solution" matTooltipPosition="above" (click)="deleteSolution(i)"
                    *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">
                    <mat-icon>delete</mat-icon>
                  </a>
                  <a mat-mini-fab class="action-btn" color="primary" [matTooltip]="solution.hideContent?'展開':'收合'" matTooltipPosition="above"
                    (click)="solution.hideContent = !solution.hideContent">
                    <mat-icon *ngIf="solution.hideContent">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="!solution.hideContent">keyboard_arrow_up</mat-icon>
                  </a>
                </mat-card-title>
                <mat-card-content fxLayout="column" [hidden]="!solution.hideContent">
                  {{solution.title}}
                </mat-card-content>
                <mat-card-content fxLayout="column" [hidden]="solution.hideContent">
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="title" [name]="'solutionTitle'+i" [(ngModel)]="solution.title" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="Url" [name]="'solutionUrl'+i" [(ngModel)]="solution.url" [readOnly]="!pageIsEditable">
                  </mat-form-field>
                </mat-card-content>
                <button type="button" mat-button (click)="addSolution(i+1)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Solution</button>
              </div>
            </div>
          </mat-card-content>
          <!--Software-->
          <mat-card-content fxLayout="column">
            <button type="button" mat-button (click)="addSoftware(0)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Software</button>
            <div [sortablejs]="data.software" [sortablejsOptions]="groupOptions">
              <div fxLayout="column" fxLayoutAlign="start stretch" *ngFor="let softwareItem of data.software; let i = index">
                <mat-card-title>
                  <mat-icon class="drag-handle" *ngIf="pageIsEditable">drag_handle</mat-icon>
                  <h3>Software {{i+1}}</h3>
                  <a mat-mini-fab class="action-btn" color="accent" matTooltip="Delete Software" matTooltipPosition="above" (click)="deleteSoftware(i)"
                    *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">
                    <mat-icon>delete</mat-icon>
                  </a>
                  <a mat-mini-fab class="action-btn" color="primary" [matTooltip]="softwareItem.hideContent?'展開':'收合'" matTooltipPosition="above"
                    (click)="softwareItem.hideContent = !softwareItem.hideContent">
                    <mat-icon *ngIf="softwareItem.hideContent">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="!softwareItem.hideContent">keyboard_arrow_up</mat-icon>
                  </a>
                </mat-card-title>
                <mat-card-content fxLayout="column" [hidden]="!softwareItem.hideContent">
                  {{softwareItem.title}}
                </mat-card-content>
                <mat-card-content fxLayout="column" [hidden]="softwareItem.hideContent">
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="title" [name]="'softwareTitle'+i" [(ngModel)]="softwareItem.title" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="Url" [name]="'softwareUrl'+i" [(ngModel)]="softwareItem.url" [readOnly]="!pageIsEditable">
                  </mat-form-field>
                </mat-card-content>
                <button type="button" mat-button (click)="addSoftware(i+1)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Software</button>
              </div>
            </div>
          </mat-card-content>
          <!--Partners-->
          <mat-card-content fxLayout="column">
            <button type="button" mat-button (click)="addPartner(0)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Partner</button>
            <div [sortablejs]="data.partners" [sortablejsOptions]="groupOptions">
              <div fxLayout="column" fxLayoutAlign="start stretch" *ngFor="let partner of data.partners; let i = index">
                <mat-card-title>
                  <mat-icon class="drag-handle" *ngIf="pageIsEditable">drag_handle</mat-icon>
                  <h3>Partner {{i+1}}</h3>
                  <a mat-mini-fab class="action-btn" color="accent" matTooltip="Delete Partner" matTooltipPosition="above" (click)="deletePartner(i)"
                    *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">
                    <mat-icon>delete</mat-icon>
                  </a>
                  <a mat-mini-fab class="action-btn" color="primary" [matTooltip]="partner.hideContent?'展開':'收合'" matTooltipPosition="above"
                    (click)="partner.hideContent = !partner.hideContent">
                    <mat-icon *ngIf="partner.hideContent">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="!partner.hideContent">keyboard_arrow_up</mat-icon>
                  </a>
                </mat-card-title>
                <mat-card-content fxLayout="column" [hidden]="!partner.hideContent">
                  {{partner.title}}
                </mat-card-content>
                <mat-card-content fxLayout="column" [hidden]="partner.hideContent">
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="title" [name]="'partnerTitle'+i" [(ngModel)]="partner.title" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="Url" [name]="'partnerUrl'+i" [(ngModel)]="partner.url" [readOnly]="!pageIsEditable">
                  </mat-form-field>
                </mat-card-content>
                <button type="button" mat-button (click)="addPartner(i+1)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Partner</button>
              </div>
            </div>
          </mat-card-content>
          <!--圖片-->
          <mat-card-content fxLayout="column">
            <div fxLayout="row" fxLayoutAlign="center" *ngIf="data.image.src">
              <div class="text-center">
                <img [src]="data.image.src | safeUrl" [alt]="data.image.alt" [title]="data.image.title">
              </div>
            </div>
            <button type="button" mat-button (click)="imgFileInput.click()" [disabled]="isLoading" *ngIf="pageIsEditable">Upload a image (Recommended size: 460*230)</button>
            <input hidden type="file" #imgFileInput accept="image/*" (change)="imgFileSelect($event)" />
            <mat-form-field fxFlex>
              <input matInput placeholder="Image url (Applied to All)" name="imageSrc" [(ngModel)]="data.image.src" [readOnly]="!pageIsEditable"
                required>
            </mat-form-field>
            <mat-form-field fxFlex>
              <input matInput maxlength="255" placeholder="Image title" name="imageTitle" [(ngModel)]="data.image.title" [readOnly]="!pageIsEditable"
                required>
            </mat-form-field>
            <mat-form-field fxFlex>
              <input matInput placeholder="Image alt" name="imageAlt" [(ngModel)]="data.image.alt" [readOnly]="!pageIsEditable" required>
            </mat-form-field>
          </mat-card-content>
          <!--樣板-->
          <vvtk-templates #templates path="SuccessCase" [readOnly]="!pageIsEditable"></vvtk-templates>
          <!--感謝-->
          <mat-card-content fxLayout="column">
            <button type="button" mat-button (click)="addSpecialThanks(0)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Special Thanks</button>
            <div [sortablejs]="data.specialThanksList" [sortablejsOptions]="groupOptions">
              <div fxLayout="column" fxLayoutAlign="start stretch" *ngFor="let item of data.specialThanksList; let i = index">
                <mat-card-title>
                  <mat-icon class="drag-handle" *ngIf="pageIsEditable">drag_handle</mat-icon>
                  <h3>Special Thanks {{i+1}}</h3>
                  <a mat-mini-fab class="action-btn" color="accent" matTooltip="Delete Special Thanks" matTooltipPosition="above" (click)="deleteSpecialThanks(i)"
                    *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">
                    <mat-icon>delete</mat-icon>
                  </a>
                  <a mat-mini-fab class="action-btn" color="primary" [matTooltip]="item.hideContent?'展開':'收合'" matTooltipPosition="above" (click)="item.hideContent = !item.hideContent">
                    <mat-icon *ngIf="item.hideContent">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="!item.hideContent">keyboard_arrow_up</mat-icon>
                  </a>
                </mat-card-title>
                <mat-card-content fxLayout="column" [hidden]="!item.hideContent">
                  {{item.title}}
                </mat-card-content>
                <mat-card-content fxLayout="column" [hidden]="item.hideContent">
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="Title" [name]="'specialThanksTitle'+i" [(ngModel)]="item.title" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput placeholder="Url/Path" [name]="'specialThanksUrl'+i" [(ngModel)]="item.url" [readOnly]="!pageIsEditable">
                  </mat-form-field>
                </mat-card-content>
                <button type="button" mat-button (click)="addSpecialThanks(i+1)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">Add Special Thanks</button>
              </div>
            </div>
          </mat-card-content>
          <!--相關-->
          <mat-card-content fxLayout="column">
            <button type="button" mat-button (click)="addRelated(0)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global') && data.relatedList.length<3">Add Related</button>
            <div [sortablejs]="data.relatedList" [sortablejsOptions]="groupOptions">
              <div fxLayout="column" fxLayoutAlign="start stretch" *ngFor="let related of data.relatedList; let i = index">
                <mat-card-title>
                  <mat-icon class="drag-handle" *ngIf="pageIsEditable">drag_handle</mat-icon>
                  <h3>Related {{i+1}}</h3>
                  <a mat-mini-fab class="action-btn" color="accent" matTooltip="Delete Related" matTooltipPosition="above" (click)="deleteRelated(i)"
                    *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global')">
                    <mat-icon>delete</mat-icon>
                  </a>
                  <a mat-mini-fab class="action-btn" color="primary" [matTooltip]="related.hideContent?'展開':'收合'" matTooltipPosition="above"
                    (click)="related.hideContent = !related.hideContent">
                    <mat-icon *ngIf="related.hideContent">keyboard_arrow_down</mat-icon>
                    <mat-icon *ngIf="!related.hideContent">keyboard_arrow_up</mat-icon>
                  </a>
                </mat-card-title>
                <mat-card-content fxLayout="column" [hidden]="!related.hideContent">
                  {{related.title}}
                </mat-card-content>
                <mat-card-content fxLayout="column" [hidden]="related.hideContent">
                  <div fxLayout="row" fxLayoutAlign="center" *ngIf="related.image.src">
                    <div class="text-center">
                      <img [src]="related.image.src | safeUrl" [alt]="related.image.alt" [title]="related.image.title">
                    </div>
                  </div>
                  <button type="button" mat-button (click)="relatedImgFileInput.click()" [disabled]="isLoading" *ngIf="pageIsEditable">Upload a image (Recommended size: 460*230)</button>
                  <input hidden type="file" #relatedImgFileInput accept="image/*" (change)="relatedImgFileSelect($event,i)" />
                  <mat-form-field fxFlex>
                    <input matInput placeholder="Image url (Applied to All)" [name]="'relatedImageSrc'+i" [(ngModel)]="related.image.src" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="Image title" [name]="'relatedImageTitle'+i" [(ngModel)]="related.image.title"
                      [readOnly]="!pageIsEditable" required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput placeholder="Image alt" [name]="'relatedImageAlt'+i" [(ngModel)]="related.image.alt" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-divider></mat-divider>
                  <mat-form-field fxFlex>
                    <input matInput maxlength="255" placeholder="Title" [name]="'relatedTitle'+i" [(ngModel)]="related.title" [readOnly]="!pageIsEditable"
                      required>
                  </mat-form-field>
                  <mat-form-field fxFlex>
                    <input matInput placeholder="Url/Path" [name]="'relatedUrl'+i" [(ngModel)]="related.url" [readOnly]="!pageIsEditable">
                  </mat-form-field>
                </mat-card-content>
                <button type="button" mat-button (click)="addRelated(i+1)" *ngIf="pageIsEditable && (id==0 || selectedLanguage=='global') && data.relatedList.length<3">Add Related</button>
              </div>
            </div>
          </mat-card-content>
          <!--狀態-->
          <mat-card-content fxLayout="column">
            <vvtk-input-container>
              <mat-slide-toggle color="primary" name="status" [(ngModel)]="status" [disabled]="!pageIsEditable" vvtkhtml>
                {{status?'Online':'Offline'}} (Applied to All)
              </mat-slide-toggle>
            </vvtk-input-container>
          </mat-card-content>
        </mat-card>
      </form>
    </mat-card-content>
    <mat-card-content fxLayout="column">
      <div fxLayout="row" fxLayoutAlign="end center">
        <button mat-button [routerLink]="['/cases/list']">Cancel</button>
        <span fxFlex></span>
        <button mat-button color="primary" (click)="save()" [disabled]="!form.valid || !templates.form.valid || isLoading" *ngIf="pageIsEditable">Save</button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
